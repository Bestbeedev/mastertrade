import{u as q,r as m,a as A,j as e,H,L as R,t as x}from"./app-CrawgoCe.js";import{A as U}from"./app-layout-DfcnZheQ.js";import{B as w}from"./auth-BgAybA0k.js";import{c as h,s as f,B as p}from"./index-DsAE6S8J.js";import{C as c,a as i,b as n,c as E,d}from"./card-CAnZI0ok.js";import{P as V}from"./progress-CUoFFPbe.js";import{A as W}from"./arrow-left-Dem7fxLY.js";import{C as G}from"./calendar-CA7gCXbD.js";import{B as J}from"./book-open-iIL5E-ol.js";import{F as K}from"./file-text-Dt_JVa7q.js";import{D as Q}from"./download-BSqmaxjG.js";import{C as y}from"./circle-play-B-PIJWqM.js";import{C as I}from"./clock-DB5bF2UD.js";import{C as g}from"./circle-check-big-HH6sNkoO.js";import{P as X}from"./play-CHxbqoA5.js";import{I as Y}from"./info-C5BBkwGX.js";import{U as Z}from"./users-dngsC8gF.js";import{T as ee}from"./target-BXAKFUBb.js";import{S as se}from"./shield-D6ffzbHa.js";/* empty css            */import"./chevron-right-CbrF_LyD.js";import"./index-CWelApJs.js";import"./index-BSR4FWt4.js";import"./index-2DkYc2p9.js";import"./index-BJrNQDjd.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ae=h("Circle",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],le=h("FolderOpen",re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],ie=h("Layers",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]],de=h("ListOrdered",ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],me=h("Lock",oe);function De(){const{course:a,is_enrolled:N=!1,progress_percent:b=0,completed_lessons:_=[]}=q().props,o=a?.modules||[],k=o.length,C=m.useMemo(()=>o.reduce((s,t)=>s+(t.lessons||[]).length,0),[o]),L=m.useMemo(()=>{const s=[];return o.forEach(t=>(t.lessons||[]).forEach(l=>s.push({...l,moduleTitle:t.title}))),s},[o]),$=L.find(s=>!_?.includes(s.id))||L[0],[r,B]=m.useState($||null),[v,S]=m.useState(0),[xe,M]=m.useState(!1);m.useEffect(()=>{S(0),M(!0);const s=setInterval(()=>S(t=>t+1),1e3);return()=>{clearInterval(s),M(!1)}},[r?.id]);const D=A({}),F=()=>{const s=x.loading("Inscription en cours...");D.post(f("courses.enroll",a.id),{onSuccess:()=>x.success("Inscription effectuée",{id:s}),onError:()=>x.error("Impossible de s'inscrire",{id:s})})},P=A({lesson_id:"",position_seconds:0,seconds_watched:0,completed:!1}),T=(s=!0)=>{if(!r)return;const t=x.loading("Mise à jour de la progression...");P.setData({lesson_id:r.id,position_seconds:v,seconds_watched:v,completed:s}),P.post(f("courses.complete-lesson",a.id),{preserveScroll:!0,onSuccess:()=>x.success("Progression mise à jour",{id:t}),onError:()=>x.error("Erreur de progression",{id:t})})},z=s=>{try{if(!s)return null;let t=s;return s.includes("watch?v=")?t=`https://www.youtube.com/embed/${new URL(s).searchParams.get("v")}?rel=0&modestbranding=1&enablejsapi=1`:s.includes("youtu.be/")?t=`https://www.youtube.com/embed/${s.split("youtu.be/")[1].split("?")[0]}?rel=0&modestbranding=1&enablejsapi=1`:s.includes("/embed/")||(t=s),t}catch{return null}};return e.jsxs(U,{breadcrumbs:[{title:"Formations",href:f("courses")},{title:a?.title||"Formation",href:""}],children:[e.jsx(H,{title:a?.title||"Formation"}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(p,{variant:"ghost",asChild:!0,children:e.jsxs(R,{href:f("courses"),className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"})," Retour"]})}),!N&&e.jsx(p,{onClick:F,children:"S'inscrire au cours"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(c,{className:"lg:col-span-2",children:[e.jsx(i,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(n,{className:"text-2xl font-bold",children:a?.title}),e.jsx(E,{className:"mt-2 text-base",children:a?.description}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{children:["Créé le ",a?.created_at?new Date(a.created_at).toLocaleDateString("fr-FR"):"—"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsxs("span",{children:[k," modules"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs("span",{children:[C," leçons"]})]}),a?.level&&e.jsx(w,{variant:"secondary",children:a.level})]})]}),N&&e.jsxs("div",{className:"flex flex-col items-end gap-2 min-w-[140px]",children:[e.jsx("div",{className:"text-sm font-medium",children:"Progression"}),e.jsx(V,{value:b||0,className:"h-2 w-32"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(b||0),"% complété"]})]})]})}),e.jsxs(d,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-lg font-semibold",children:r?r.title:"Aperçu du cours"}),r?N?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"aspect-video rounded-lg overflow-hidden bg-muted shadow-sm",children:r.type==="video"&&r.content_url?e.jsx("iframe",{className:"w-full h-full",src:z(r.content_url)||"",title:r.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowFullScreen:!0}):r.type==="pdf"&&r.content_url?e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-4",children:[e.jsx(K,{className:"h-16 w-16 text-muted-foreground"}),e.jsxs("div",{className:"text-center px-6",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Document PDF"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Téléchargez ce document pour le consulter sur votre appareil."}),e.jsx(p,{asChild:!0,className:"gap-2",children:e.jsxs("a",{href:`/storage/${r.content_url}`,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Q,{className:"h-4 w-4"}),"Télécharger le PDF"]})})]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(y,{className:"h-16 w-16 text-primary"})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsxs("span",{children:["Temps suivi: ",v,"s"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>T(!1),children:"Sauvegarder"}),e.jsxs(p,{size:"sm",onClick:()=>T(!0),className:"gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Terminer"]})]})]})]}):e.jsxs("div",{className:"space-y-4 text-center py-8",children:[e.jsx("div",{className:"aspect-video rounded-lg bg-muted flex items-center justify-center",children:e.jsx(me,{className:"h-16 w-16 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"Contenu verrouillé"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:"Inscrivez-vous à cette formation pour accéder à tous les contenus."})]}),e.jsxs(p,{onClick:F,size:"lg",className:"gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"S'inscrire maintenant"]})]}):e.jsx("div",{className:"aspect-video rounded-lg bg-muted flex items-center justify-center",children:e.jsx(X,{className:"h-16 w-16 text-primary"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a?.intro&&e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsxs(n,{className:"flex items-center gap-2 font-semibold",children:[e.jsx(Y,{className:"h-4 w-4 text-lg text-blue-600"}),"Introduction"]})}),e.jsx(d,{className:"pt-0",children:e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-line",children:a.intro})})]}),a?.audience&&e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsxs(n,{className:"flex items-center gap-2  font-semibold",children:[e.jsx(Z,{className:"h-4 w-4 text-lg text-green-600"}),"Public cible"]})}),e.jsx(d,{className:"pt-0",children:e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-line",children:a.audience})})]}),a?.what_you_will_learn&&e.jsxs(c,{className:"md:col-span-2",children:[e.jsx(i,{className:"pb-3",children:e.jsxs(n,{className:"flex items-center gap-2  font-semibold",children:[e.jsx(ee,{className:"h-4 w-4 text-lg text-purple-600"}),"Objectifs d'apprentissage"]})}),e.jsx(d,{className:"pt-0",children:e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:String(a.what_you_will_learn).split(`
`).filter(Boolean).map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(g,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t))})})]}),a?.requirements&&e.jsxs(c,{className:"md:col-span-2",children:[e.jsx(i,{className:"pb-3",children:e.jsxs(n,{className:"flex items-center gap-2 font-semibold",children:[e.jsx(se,{className:"h-4 w-4 text-orange-600 text-lg"}),"Prérequis"]})}),e.jsx(d,{className:"pt-0",children:e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:String(a.requirements).split(`
`).filter(Boolean).map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-orange-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s})]},t))})})]})]}),a?.tags&&e.jsxs(c,{children:[e.jsx(i,{className:"pb-3",children:e.jsx(n,{className:"text-sm font-semibold",children:"Tags"})}),e.jsx(d,{className:"pt-0",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:String(a.tags).split(",").map((s,t)=>e.jsx(w,{variant:"outline",className:"px-3 py-1",children:s.trim()},t))})})]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs(c,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsxs(n,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx(de,{className:"h-5 w-5 text-primary"}),"Plan du cours"]}),e.jsxs(E,{children:[k," modules • ",C," leçons"]})]}),e.jsx(d,{className:"space-y-4 max-h-[600px] overflow-y-auto",children:(o||[]).map((s,t)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-primary"}),e.jsx("h4",{className:"font-semibold text-sm",children:s.title}),e.jsxs("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded",children:[s.lessons?.length||0," leçons"]})]}),e.jsx("div",{className:"space-y-2 ml-6",children:(s.lessons||[]).map((l,O)=>{const u=(_||[]).includes(l.id),j=r?.id===l.id;return e.jsxs("button",{className:`w-full flex items-center justify-between p-3 rounded-lg border text-left transition-all ${j?"bg-accent border-primary shadow-sm":u?"bg-green-50 border-green-200 dark:bg-green-900/20":"hover:bg-accent border-border"}`,onClick:()=>B(l),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`h-8 w-8 rounded flex items-center justify-center flex-shrink-0 ${j?"bg-primary text-primary-foreground":u?"bg-green-100 text-green-600 dark:bg-green-800":"bg-muted text-muted-foreground"}`,children:u?e.jsx(g,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:`font-medium text-sm truncate ${j?"text-primary":""}`,children:l.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{children:l.duration_seconds?Math.round(l.duration_seconds/60)+" min":"—"}),l.type&&e.jsx(w,{variant:"secondary",className:"text-xs py-0 px-1.5",children:l.type})]})]})]}),u&&!j&&e.jsx(g,{className:"h-4 w-4 text-green-600 flex-shrink-0"})]},l.id||O)})})]},s.id||t))})]})})]})]})]})}export{De as default};
