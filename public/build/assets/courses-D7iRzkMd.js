import{U as h,a as z,j as e,H as le,L as ne,t as p}from"./app-B3Y0P8eL.js";import{A as oe}from"./app-layout-BmrSMU7B.js";import{C as L,a as P,b,c as y,d as A,e as de}from"./card-B6WQ6knZ.js";import{B as d,s as w}from"./index-BS9Mkhtc.js";import{I as c}from"./input-B58C95N6.js";import{C as I}from"./checkbox-BxdpT5nu.js";import{S as q,a as M,b as $,c as E,d as C}from"./select-CRiprpJX.js";import{T as V,a as B,b as u,c as m}from"./tabs-7x_I4q-o.js";import{L as i}from"./label-Dhbczhvd.js";import{D as G}from"./dropzone-BHNvWpXd.js";import{D as O,a as H,b as R,c as Y,d as U}from"./dialog-DgY4hv6z.js";import{P as g}from"./plus-DJXp46-F.js";import{B as J}from"./book-open-Bskm4tST.js";import{I as K}from"./image-CuGWnwnt.js";import{I as Q}from"./info-Bj0kZ_4j.js";import{T as _}from"./trash-2-nXQCgoxj.js";import{T as ce}from"./tag-BjPciNeU.js";import{F as ue}from"./file-text-1gYjgS_u.js";/* empty css            */import"./auth-ClV7ZO7P.js";import"./index-BJlpveyn.js";import"./index-DOpKAXXZ.js";import"./index-B7VOcpwy.js";import"./index-ChXgRNoH.js";import"./chevron-right-CR-mXq2c.js";import"./index-DN2tWQS9.js";import"./check-Dwe-_DrS.js";function Ee({courses:D=[],products:W=[]}){const[v,f]=h.useState("list"),[n,F]=h.useState(null),[X,k]=h.useState("info"),a=z({title:"",description:"",intro:"",what_you_will_learn:"",requirements:"",audience:"",level:"",tags:"",is_paid:!1,price:"",product_id:"",modules:[],cover_image:null});h.useEffect(()=>{v==="new"&&k("info")},[v]);const Z=()=>{const s=[...a.data.modules||[]];s.push({title:"",description:"",position:s.length,lessons:[]}),a.setData("modules",s)},ee=s=>{const t=[...a.data.modules||[]];t.splice(s,1),a.setData("modules",t.map((r,l)=>({...r,position:l})))},T=(s,t)=>{const r=[...a.data.modules||[]];r[s]={...r[s],...t},a.setData("modules",r)},se=s=>{const t=[...a.data.modules||[]],r=[...t[s]?.lessons||[]];r.push({title:"",type:"video",content_url:"",is_preview:!1,duration_seconds:""}),t[s]={...t[s],lessons:r},a.setData("modules",t)},ae=(s,t)=>{const r=[...a.data.modules||[]],l=[...r[s]?.lessons||[]];l.splice(t,1),r[s]={...r[s],lessons:l},a.setData("modules",r)},x=(s,t,r)=>{const l=[...a.data.modules||[]],o=[...l[s]?.lessons||[]];o[t]={...o[t],...r},l[s]={...l[s],lessons:o},a.setData("modules",l)},te=s=>{s.preventDefault();const t=p.loading("Création de la formation...");a.post(w("admin.courses.store"),{onSuccess:()=>{p.success("Formation créée avec succès",{id:t}),a.reset(),f("list")},onError:()=>p.error("Erreur lors de la création",{id:t}),forceFormData:!0})},{delete:re,processing:S}=z({}),[N,j]=h.useState(null),ie=()=>{if(!N)return;const s=p.loading("Suppression en cours...");re(w("admin.courses.destroy",{course:N.id}),{onSuccess:()=>{p.success("Formation supprimée",{id:s}),j(null)},onError:()=>p.error("Erreur lors de la suppression",{id:s})})};return e.jsxs(oe,{breadcrumbs:[{title:"Admin",href:"/admin"},{title:"Formations",href:"/admin/courses"}],children:[e.jsx(le,{title:"Admin • Gestion des Formations"}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Gestion des Formations"}),e.jsx("p",{className:"text-muted-foreground",children:"Créez et gérez vos formations"})]}),e.jsxs(d,{onClick:()=>f("new"),children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Nouvelle Formation"]})]}),e.jsxs(V,{value:v,onValueChange:f,className:"space-y-4",children:[e.jsxs(B,{children:[e.jsxs(u,{value:"list",className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"})," Liste des formations"]}),e.jsxs(u,{value:"new",className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"})," Nouvelle formation"]})]}),e.jsx(m,{value:"list",className:"space-y-4",children:e.jsxs(L,{children:[e.jsxs(P,{children:[e.jsx(b,{children:"Formations existantes"}),e.jsx(y,{children:"Couverture, modules, inscrits et métadonnées"})]}),e.jsx(A,{className:"space-y-3",children:D?.length?e.jsx("div",{className:"divide-y rounded-md border",children:D.map(s=>e.jsxs("div",{className:"flex flex-col gap-3 p-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1 sm:items-center",children:[s.cover_image?e.jsx("img",{src:`/storage/${s.cover_image}`,alt:s.title,className:"h-16 w-24 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:"h-16 w-24 rounded-md bg-muted flex items-center justify-center text-xs text-muted-foreground flex-shrink-0",children:e.jsx(K,{})}),e.jsxs("div",{className:"space-y-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-bold truncate",children:s.title}),s.is_paid?e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-md bg-orange-50 text-orange-700 border border-orange-200",children:["Payante",s.price?` ${(Number(s.price)||0).toFixed(2)} FCFA`:""]}):e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-md bg-emerald-50 text-emerald-700 border border-emerald-200",children:"Gratuite"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-3",children:[e.jsx("span",{children:s.product?.name?`Produit : ${s.product.name}`:"Sans produit lié"}),e.jsxs("span",{children:["Modules : ",s.modules_count??0]}),e.jsxs("span",{children:["Leçons : ",s.lessons_count??0]}),e.jsxs("span",{children:["Inscrits : ",s.enrollments_count??0]}),e.jsxs("span",{children:["Créée le ",s.created_at?new Date(s.created_at).toLocaleDateString("fr-FR"):"—"]}),s.duration_seconds?e.jsxs("span",{children:["Durée ~ ",Math.round(s.duration_seconds/60||0)," min"]}):null]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end sm:flex-nowrap sm:justify-end flex-shrink-0",children:[e.jsxs(d,{type:"button",variant:"outline",size:"sm",className:"gap-1",onClick:()=>F(s),children:[e.jsx(Q,{className:"h-4 w-4"}),"Détails"]}),e.jsx(d,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(ne,{href:w("admin.courses.edit",s.id),children:"Éditer"})}),e.jsx(d,{variant:"destructive",size:"sm",type:"button",onClick:()=>j(s),disabled:S,children:e.jsx(_,{className:"h-4 w-4"})})]})]},s.id))}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Aucune formation pour l’instant."})})]})}),e.jsx(m,{value:"new",children:e.jsx("form",{onSubmit:te,children:e.jsxs(L,{children:[e.jsxs(P,{children:[e.jsx(b,{children:"Nouvelle Formation"}),e.jsx(y,{children:"Renseignez les informations de votre formation"})]}),e.jsx(A,{className:"space-y-6",children:e.jsxs(V,{value:X,onValueChange:k,className:"space-y-4",children:[e.jsxs(B,{children:[e.jsxs(u,{value:"info",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"})," Infos"]}),e.jsxs(u,{value:"pricing",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"})," Tarification"]}),e.jsxs(u,{value:"content",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"})," Contenu"]}),e.jsxs(u,{value:"media",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"})," Médias"]}),e.jsxs(u,{value:"modules",className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"})," Modules"]})]}),e.jsx(m,{value:"info",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Titre"}),e.jsx(c,{id:"title",value:a.data.title,onChange:s=>a.setData("title",s.target.value),placeholder:"Titre de la formation",required:!0})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"product_id",children:"Produit lié (optionnel)"}),e.jsxs(q,{value:a.data.product_id,onValueChange:s=>a.setData("product_id",s),children:[e.jsx(M,{className:"w-full",children:e.jsx($,{placeholder:"Sélectionnez un produit"})}),e.jsx(E,{children:W?.map(s=>e.jsx(C,{value:s.id,children:s.name},s.id))})]})]})})]})}),e.jsx(m,{value:"pricing",className:"space-y-6",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Payant ?"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{id:"is_paid",checked:!!a.data.is_paid,onCheckedChange:s=>a.setData("is_paid",!!s)}),e.jsx(i,{htmlFor:"is_paid",className:"text-sm text-muted-foreground",children:"Cocher si la formation est payante"})]})]}),a.data.is_paid&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"price",children:"Prix"}),e.jsx(c,{id:"price",type:"number",min:"0",step:"0.01",value:a.data.price,onChange:s=>a.setData("price",s.target.value),placeholder:"0.00"})]})]})})}),e.jsxs(m,{value:"content",className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro",children:"Introduction (optionnel)"}),e.jsx("textarea",{id:"intro",value:a.data.intro,onChange:s=>a.setData("intro",s.target.value),placeholder:"Texte d’introduction, points clés, bénéfices...",rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",value:a.data.description,onChange:s=>a.setData("description",s.target.value),placeholder:"Décrivez la formation",rows:4,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"what_you_will_learn",children:"Ce que vous apprendrez"}),e.jsx("textarea",{id:"what_you_will_learn",value:a.data.what_you_will_learn,onChange:s=>a.setData("what_you_will_learn",s.target.value),rows:4,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:`Point 1
Point 2
Point 3`})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"requirements",children:"Prérequis"}),e.jsx("textarea",{id:"requirements",value:a.data.requirements,onChange:s=>a.setData("requirements",s.target.value),rows:4,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:`Compétence A
Outil B`})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(i,{htmlFor:"audience",children:"Pour qui ?"}),e.jsx("textarea",{id:"audience",value:a.data.audience,onChange:s=>a.setData("audience",s.target.value),rows:3,className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Débutants, Étudiants, Professionnels..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"level",children:"Niveau"}),e.jsx(c,{id:"level",value:a.data.level,onChange:s=>a.setData("level",s.target.value),placeholder:"Débutant / Intermédiaire / Avancé"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"tags",children:"Tags"}),e.jsx(c,{id:"tags",value:a.data.tags,onChange:s=>a.setData("tags",s.target.value),placeholder:"ex: sécurité, windows, réseau"})]})]})]}),e.jsx(m,{value:"media",className:"space-y-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"Bannière de couverture"}),e.jsx(G,{accept:"image/*",multiple:!1,value:a.data.cover_image?[a.data.cover_image]:[],onFiles:s=>a.setData("cover_image",s[0]??null),className:"min-h-[100px]",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Glissez-déposez une image ou cliquez pour sélectionner"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Formats acceptés: .jpg, .jpeg, .png"})]})})]})}),e.jsxs(m,{value:"modules",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(b,{children:"Modules et Leçons"}),e.jsx(y,{children:"Organisez la formation par étapes/modules"})]}),e.jsxs(d,{type:"button",variant:"outline",onClick:Z,className:"gap-2",children:[e.jsx(g,{className:"h-4 w-4"})," Ajouter un module"]})]}),e.jsx("div",{className:"space-y-4",children:(a.data.modules||[]).map((s,t)=>e.jsxs("div",{className:"rounded-md border p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex-1 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{children:"Titre du module"}),e.jsx(c,{value:s.title,onChange:r=>T(t,{title:r.target.value}),placeholder:`Module ${t+1}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{children:"Description"}),e.jsx(c,{value:s.description||"",onChange:r=>T(t,{description:r.target.value}),placeholder:"Description du module (optionnel)"})]})]}),e.jsx(d,{type:"button",variant:"destructive",size:"icon",onClick:()=>ee(t),children:e.jsx(_,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Leçons"}),e.jsxs(d,{type:"button",variant:"secondary",onClick:()=>se(t),className:"gap-2",children:[e.jsx(g,{className:"h-4 w-4"})," Ajouter une leçon"]})]}),e.jsx("div",{className:"space-y-3",children:(s.lessons||[]).map((r,l)=>e.jsx("div",{className:"rounded border p-3 space-y-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2 flex-1",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{children:"Titre"}),e.jsx(c,{value:r.title,onChange:o=>x(t,l,{title:o.target.value}),placeholder:"Titre de la leçon"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{children:"Type"}),e.jsxs(q,{value:r.type,onValueChange:o=>x(t,l,{type:o,content_url:"",file:void 0}),children:[e.jsx(M,{className:"w-full",children:e.jsx($,{placeholder:"Type de contenu"})}),e.jsxs(E,{children:[e.jsx(C,{value:"video",children:"Vidéo (YouTube)"}),e.jsx(C,{value:"pdf",children:"PDF / Ebook"})]})]})]}),r.type==="video"?e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx(i,{children:"Lien YouTube"}),e.jsx(c,{value:r.content_url||"",onChange:o=>x(t,l,{content_url:o.target.value}),placeholder:"https://www.youtube.com/watch?v=..."})]}):e.jsxs("div",{className:"space-y-1 md:col-span-2",children:[e.jsx(i,{children:"Fichier PDF"}),e.jsx(G,{accept:"application/pdf",multiple:!1,onFiles:o=>x(t,l,{file:o[0]}),children:e.jsx("span",{children:"Glissez-déposez un PDF ou cliquez pour sélectionner"})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{children:"Durée (secondes, optionnel)"}),e.jsx(c,{type:"number",min:"0",value:r.duration_seconds||"",onChange:o=>x(t,l,{duration_seconds:o.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{id:`prev_${t}_${l}`,checked:!!r.is_preview,onCheckedChange:o=>x(t,l,{is_preview:!!o})}),e.jsx(i,{htmlFor:`prev_${t}_${l}`,className:"text-sm",children:"Leçon d'aperçu (gratuite)"})]})]}),e.jsx(d,{type:"button",variant:"outline",size:"icon",onClick:()=>ae(t,l),children:e.jsx(_,{className:"h-4 w-4"})})]})},l))})]})]},t))})]})]})}),e.jsxs(de,{className:"flex justify-between border-t px-6 py-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>a.reset(),children:"Annuler"}),e.jsx(d,{type:"submit",disabled:a.processing,children:a.processing?"Enregistrement...":"Créer la formation"})]})]})})})]}),e.jsx(O,{open:!!n,onOpenChange:s=>{s||F(null)},children:e.jsxs(H,{children:[e.jsxs(R,{children:[e.jsx(Y,{children:"Détails de la formation"}),e.jsx(U,{children:"Vue détaillée de la formation sélectionnée."})]}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[n.cover_image?e.jsx("img",{src:`/storage/${n.cover_image}`,alt:n.title,className:"h-24 w-40 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:"h-24 w-40 rounded-md bg-muted flex items-center justify-center text-xs text-muted-foreground flex-shrink-0",children:"Pas de cover"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-base",children:n.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Créée le ",n.created_at?new Date(n.created_at).toLocaleDateString("fr-FR"):"—"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.product?.name?`Produit lié : ${n.product.name}`:"Aucun produit lié"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Modules : ",n.modules_count??0," • Leçons : ",n.lessons_count??0," • Inscrits : ",n.enrollments_count??0]}),n.duration_seconds?e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Durée estimée ~ ",Math.round(n.duration_seconds/60||0)," minutes"]}):null]})]}),n.description&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:n.description})]})]})]})}),e.jsx(O,{open:!!N,onOpenChange:s=>{s||j(null)},children:e.jsxs(H,{children:[e.jsxs(R,{children:[e.jsx(Y,{children:"Confirmer la suppression"}),e.jsx(U,{children:"Êtes-vous sûr de vouloir supprimer cette formation ? Cette action est définitive et supprimera également les modules, leçons et inscriptions associées."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(d,{variant:"outline",type:"button",onClick:()=>j(null),children:"Annuler"}),e.jsx(d,{variant:"destructive",type:"button",onClick:ie,disabled:S,children:"Supprimer"})]})]})})]})]})}export{Ee as default};
