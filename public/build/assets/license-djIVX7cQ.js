import{r as m,j as e,H as E,t as A}from"./app-CrawgoCe.js";import{A as R}from"./app-layout-DfcnZheQ.js";import{B as a,s as N}from"./index-DsAE6S8J.js";import{C as i,d as l,a as u,b as p,c as w}from"./card-CAnZI0ok.js";import{r as $,e as M,B as b}from"./auth-BgAybA0k.js";import{P as F}from"./progress-CUoFFPbe.js";import{D as U,a as B,b as H,c as K,e as q}from"./dialog-DUMmkX7I.js";import{K as h}from"./key-1DmwhE1Y.js";import{C as G}from"./calendar-CA7gCXbD.js";import{U as I}from"./users-dngsC8gF.js";import{C as O}from"./circle-alert-BIIyd15M.js";import{I as V}from"./IconCheck-tCMtXFc1.js";import{C as Y}from"./copy-BE48zhnQ.js";import{D as _}from"./download-BSqmaxjG.js";/* empty css            */import"./chevron-right-CbrF_LyD.js";import"./index-CWelApJs.js";import"./index-BSR4FWt4.js";import"./index-2DkYc2p9.js";import"./index-BJrNQDjd.js";function he({licenses:o}){const y=[{title:"Licenses",href:"/client/license"}],[C,j]=m.useState(null),r=o&&o.length?o:[],n=r.filter(s=>s.expires&&(new Date(s.expires).getTime()-Date.now())/864e5<=30&&new Date(s.expires).getTime()-Date.now()>0).length,D=[{title:"Licences actives",value:`${r.filter(s=>s.status==="active").length}`,description:"En cours de validité",icon:h,trend:"up"},{title:"Expirent bientôt",value:`${n}`,description:"Dans 30 jours",icon:G,trend:"neutral"},{title:"Utilisateurs totaux",value:`${r.reduce((s,t)=>s+t.usedSeats,0)}`,description:`Sur ${r.reduce((s,t)=>s+t.seats,0)} sièges`,icon:I,trend:"up"},{title:"Produits",value:`${new Set(r.map(s=>s.product?.name)).size}`,description:"Sous licence",icon:$,trend:"stable"}],g=(s,t)=>{navigator.clipboard.writeText(s),A.success("License copiée dans le presse-papiers..."),j(t),setTimeout(()=>j(null),2e3)},k=s=>({active:{variant:"default",text:"Active"},expired:{variant:"destructive",text:"Expirée"},suspended:{variant:"secondary",text:"Suspendue"},pending:{variant:"outline",text:"En attente"}})[s],[S,f]=m.useState(!1),[c,P]=m.useState(null),v=s=>{if(!s)return null;const t=new Date,d=new Date(t.getFullYear(),t.getMonth(),t.getDate()),x=new Date(s),L=new Date(x.getFullYear(),x.getMonth(),x.getDate()),z=1440*60*1e3;return Math.round((L.getTime()-d.getTime())/z)},T=({date:s})=>{const t=v(s);return t===null?null:t<0?e.jsxs("span",{className:"text-xs text-destructive",children:["Expirée il y a ",Math.abs(t)," j"]}):t===0?e.jsx("span",{className:"text-xs text-amber-600",children:"Expire aujourd’hui"}):t<=30?e.jsxs("span",{className:"text-xs text-amber-600",children:["Reste ",t," j"]}):e.jsxs("span",{className:"text-xs text-emerald-600",children:["Reste ",t," j"]})};return e.jsxs(R,{breadcrumbs:y,children:[e.jsx(E,{title:"Mes Licenses"}),e.jsx("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:e.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gestion des Licenses"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Consultez et gérez vos licences logicielles"})]}),e.jsxs(a,{children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Actualiser les licences"]})]})})}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8",children:[n>0&&e.jsx("div",{className:"mb-8",children:e.jsx(i,{className:"bg-orange-50 dark:bg-orange-900/20 border-orange-200 dark:border-orange-800",children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-orange-600 dark:text-orange-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-orange-900 dark:text-orange-100",children:"Licences expirant bientôt"}),e.jsx("p",{className:"text-orange-700 dark:text-orange-300 text-sm mt-1",children:n===1?"Une de vos licences expire dans moins de 30 jours. Pensez à la renouveler.":`${n} licences expirent dans moins de 30 jours. Pensez à les renouveler.`})]})]})})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:D.map((s,t)=>e.jsxs(i,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:s.title}),typeof s.icon=="string"?e.jsx("span",{className:"text-muted-foreground text-lg",children:s.icon}):e.jsx(s.icon,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s.value}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]},t))}),e.jsxs("div",{className:"space-y-6",children:[r.length===0&&e.jsx(i,{className:"border-dashed",children:e.jsxs(l,{className:"py-8 flex flex-col items-center justify-center text-center gap-2",children:[e.jsx(h,{className:"h-8 w-8 text-muted-foreground mb-1"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Vous n'avez encore aucune licence associée à votre compte. Lorsque vous achèterez un produit avec licence, il apparaîtra ici."})]})}),r.map(s=>{const t=k(s.status),d=s.usedSeats/s.seats*100;return s.expires&&v(s.expires),e.jsx(i,{className:"hover:shadow-lg transition-all",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(h,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"space-y-4 flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-xl mb-2",children:s.product?.name??"Produit"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Version: ",s.product?.version??"—"]}),e.jsxs("span",{children:["Type: ",s.type]}),e.jsx(b,{variant:"default",children:"Support"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(b,{variant:t.variant,children:t.text}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Expire le: ",s.expires?new Date(s.expires).toLocaleDateString("fr-FR"):"—"," ",s.expires?e.jsx("span",{className:"mx-1",children:"•"}):null,s.expires?e.jsx(T,{date:s.expires}):null]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Utilisation des sièges"}),e.jsxs("span",{className:"font-medium",children:[s.usedSeats,"/",s.seats," utilisateurs"]})]}),e.jsx(F,{value:d,className:"h-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Clé de licence"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"bg-muted px-3 py-2 rounded text-sm font-mono flex-1 border",children:s.key}),C===s.key?e.jsxs(a,{size:"sm",onClick:()=>g(s.key,s.key),className:"flex items-center  gap-2 bg-green-400",children:[e.jsx(V,{className:"h-4 w-4 "}),"Copié!"]}):e.jsxs(a,{variant:"default",size:"sm",onClick:()=>g(s.key,s.key),className:"flex items-center gap-2 ",children:[e.jsx(Y,{className:"h-4 w-4"}),"Copier"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 lg:w-48",children:[e.jsxs(a,{className:"w-full",onClick:()=>{P(s),f(!0)},children:[e.jsx(_,{className:"h-4 w-4 mr-2"})," Certificat"]}),e.jsx(a,{variant:"outline",className:"w-full",children:"Renouveler"}),e.jsx(a,{variant:"secondary",className:"w-full",children:"Gérer les sièges"})]})]})})},s.id)})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Actions rapides"}),e.jsx(w,{children:"Gestion simplifiée de vos licences"})]}),e.jsxs(l,{className:"space-y-3",children:[e.jsx(a,{variant:"outline",className:"w-full justify-start",children:"Demander une extension de licence"}),e.jsx(a,{variant:"outline",className:"w-full justify-start",children:"Ajouter des sièges supplémentaires"}),e.jsx(a,{variant:"outline",className:"w-full justify-start",children:"Télécharger tous les certificats"})]})]}),e.jsxs(i,{children:[e.jsxs(u,{children:[e.jsx(p,{children:"Support licence"}),e.jsx(w,{children:"Assistance dédiée aux questions de licence"})]}),e.jsxs(l,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Pour toute question concernant vos licences, transferts ou modifications."}),e.jsx(a,{variant:"outline",className:"w-full",children:"Contacter le support licence"})]})]})]}),e.jsx(U,{open:S,onOpenChange:f,children:e.jsxs(B,{className:"max-w-4xl lg:max-w-6xl xl:max-w-7xl max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsx(K,{children:"Certificat de licence"})}),e.jsx("div",{className:"rounded-md border overflow-hidden",style:{height:"70vh"},children:c?e.jsx("iframe",{src:`${N("licenses.certificate",{license:c.id})}`,className:"w-full h-full"}):null}),e.jsx(q,{children:c?e.jsx(a,{asChild:!0,children:e.jsx("a",{href:`${N("licenses.certificate",{license:c.id})}?download=1`,target:"_blank",rel:"noopener",children:"Télécharger le PDF"})}):null})]})})]})]})}export{he as default};
