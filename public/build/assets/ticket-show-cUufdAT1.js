import{u as p,a as g,j as e,H as _,L as T,t}from"./app-B3Y0P8eL.js";import{A as F}from"./app-layout-BmrSMU7B.js";import{C as A,a as D,b as L,c as S,d as $}from"./card-B6WQ6knZ.js";import{c as E,s as n,B as m}from"./index-BS9Mkhtc.js";import{B as b}from"./auth-ClV7ZO7P.js";import{L as f}from"./label-Dhbczhvd.js";import{D as P}from"./dropzone-BHNvWpXd.js";import{S as R}from"./separator-BXt9jnDV.js";import{C as z}from"./circle-check-big-CseRTbwM.js";import{C as I}from"./clock-CWl00VTJ.js";import{C as B}from"./circle-alert-CpR5lEv3.js";import{A as M}from"./arrow-left-D1RE6sKu.js";/* empty css            */import"./chevron-right-CR-mXq2c.js";import"./index-BJlpveyn.js";import"./index-DOpKAXXZ.js";import"./index-B7VOcpwy.js";import"./index-ChXgRNoH.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],q=E("Paperclip",H);function de(){const{ticket:s}=p().props;p().props?.isAdmin;const j=p().props?.auth?.user?.id,v=[{title:"Tickets",href:"/client/ticket"},{title:s?.subject||"Ticket",href:n("supportsTickets.show",s?.id)}],u={open:{variant:"destructive",text:"Ouvert",icon:B},pending:{variant:"default",text:"En cours",icon:I},closed:{variant:"secondary",text:"Ferm√©",icon:z}},c=s?.status==="in_progress"?"pending":s?.status??"open",k=u[c].icon,a=g({message:"",attachments:[]}),N=r=>{if(r.preventDefault(),!a.data.message.trim()){t.error("Merci d'ajouter un message");return}const l=t.loading("Envoi de la r√©ponse...");a.post(n("supportsTickets.reply",s.id),{onSuccess:()=>{t.success("R√©ponse envoy√©e",{id:l}),a.reset("message")},onError:()=>t.error("Impossible d'envoyer la r√©ponse",{id:l}),forceFormData:!0})},{post:x,processing:h}=g({}),y=()=>{const r=t.loading("Fermeture du ticket...");x(n("supportsTickets.close",s.id),{onSuccess:()=>t.success("Ticket ferm√©",{id:r}),onError:()=>t.error("Erreur lors de la fermeture",{id:r})})},w=()=>{const r=t.loading("R√©ouverture du ticket...");x(n("supportsTickets.reopen",s.id),{onSuccess:()=>t.success("Ticket rouvert",{id:r}),onError:()=>t.error("Erreur lors de la r√©ouverture",{id:r})})};return e.jsxs(F,{breadcrumbs:v,children:[e.jsx(_,{title:`Ticket ‚Ä¢ ${s?.subject??""}`}),e.jsxs("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{asChild:!0,variant:"ghost",children:e.jsxs(T,{href:n("supportsTickets"),className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"})," Retour"]})}),e.jsx("div",{className:"flex items-center gap-2",children:c!=="closed"?e.jsx(m,{variant:"outline",onClick:y,disabled:h,children:"Fermer"}):e.jsx(m,{variant:"outline",onClick:w,disabled:h,children:"Rouvrir"})})]}),e.jsxs(A,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(L,{className:"mb-2",children:s?.subject}),e.jsxs(S,{children:["Ticket #",s?.id]})]}),e.jsxs(b,{variant:u[c].variant,className:"flex items-center gap-1",children:[e.jsx(k,{className:"h-3 w-3"})," ",u[c].text]})]})}),e.jsxs($,{className:"space-y-6",children:[(s?.order||s?.license)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.order&&e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Commande li√©e"}),e.jsxs("div",{className:"font-medium",children:[s.order.id," ‚Ä¢ ",s.order.product?.name??"Produit"]})]}),s.license&&e.jsxs("div",{className:"rounded-lg border p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Licence li√©e"}),e.jsxs("div",{className:"font-medium",children:[s.license.id," ‚Ä¢ ",s.license.product?.name??"Produit"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Fil de discussion"}),e.jsx("div",{className:"space-y-2",children:Array.isArray(s?.messages)&&s.messages.length>0?s.messages.slice().sort((r,l)=>new Date(r.created_at).getTime()-new Date(l.created_at).getTime()).map(r=>{const d=(r?.user?.role?.name||"").toLowerCase().includes("admin"),o=r?.user_id===j;return e.jsx("div",{className:`flex ${o?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-xl border p-4 shadow-sm transition-all duration-200 ${d?"bg-gradient-to-r from-emerald-50 to-green-50 border-emerald-200 dark:from-emerald-950/40 dark:to-green-950/40 dark:border-emerald-600/30":o?"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 dark:from-blue-950/40 dark:to-indigo-950/40 dark:border-blue-600/30":"bg-gradient-to-r from-slate-50 to-gray-50 border-border dark:from-slate-800 dark:to-gray-800 dark:border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] mb-2",children:[d?e.jsx(b,{variant:"outline",className:"bg-emerald-500/20 text-emerald-700 dark:text-emerald-300 border-emerald-300 dark:border-emerald-600 truncate mr-2",children:"üë®‚Äçüíª Support Client"}):e.jsxs("span",{className:`truncate mr-2 font-medium ${o?"text-blue-700 dark:text-blue-300":"text-slate-700 dark:text-slate-300"}`,children:[r.user?.name," - ",r.user?.email]}),e.jsx("span",{className:`text-xs ${d?"text-emerald-600 dark:text-emerald-400":o?"text-blue-600 dark:text-blue-400":"text-slate-500 dark:text-slate-400"}`,children:r.created_at?new Date(r.created_at).toLocaleString("fr-FR"):""})]}),e.jsx(R,{className:d?"bg-emerald-200 dark:bg-emerald-600/30":o?"bg-blue-200 dark:bg-blue-600/30":"bg-slate-200 dark:bg-slate-600"}),e.jsx("div",{className:`whitespace-pre-wrap mt-3 text-sm font-medium ${d?"text-emerald-900 dark:text-emerald-100":o?"text-blue-900 dark:text-blue-100":"text-slate-900 dark:text-slate-100"}`,children:r.message}),Array.isArray(r.attachments)&&r.attachments.length>0&&e.jsx("div",{className:"mt-3 flex flex-col gap-2",children:r.attachments.map(i=>{const C=typeof i.mime_type=="string"&&i.mime_type.startsWith("image/");return e.jsx("div",{className:"group",children:C?e.jsx("a",{href:`/storage/${i.path}`,target:"_blank",rel:"noopener noreferrer",className:"block overflow-hidden rounded-lg border-2 border-transparent hover:border-current transition-all duration-200",children:e.jsx("img",{src:`/storage/${i.path}`,alt:i.original_name,className:"max-h-64 w-auto rounded-lg object-contain transition-transform duration-200 hover:scale-105"})}):e.jsxs("a",{href:`/storage/${i.path}`,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center gap-2 text-xs px-3 py-2 rounded-lg border transition-all duration-200 hover:shadow-md ${d?"bg-emerald-100 text-emerald-700 border-emerald-300 hover:bg-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-600":o?"bg-blue-100 text-blue-700 border-blue-300 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-600":"bg-slate-100 text-slate-700 border-slate-300 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-300 dark:border-slate-600"}`,children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"max-w-32 truncate",children:i.original_name})]})},i.id)})})]})},r.id)}):e.jsxs("div",{className:"rounded-lg border p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"Message initial"}),e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:s?.message})]})})]}),e.jsxs("form",{onSubmit:N,className:"space-y-3",children:[e.jsx(f,{htmlFor:"reply",children:"Votre r√©ponse"}),e.jsx("textarea",{id:"reply",rows:5,placeholder:"√âcrivez votre message...",value:a.data.message,onChange:r=>a.setData("message",r.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"}),e.jsxs("div",{children:[e.jsx(f,{className:"mb-2",htmlFor:"reply_attachments",children:"Pi√®ces jointes (optionnel)"}),e.jsx(P,{multiple:!0,accept:"image/*,application/pdf,text/plain,application/zip",value:a.data.attachments||[],onFiles:r=>a.setData("attachments",r),className:"min-h-[100px]",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Glissez-d√©posez des fichiers ici ou cliquez pour s√©lectionner"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Formats accept√©s: images, PDF, texte, ZIP"})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{type:"submit",disabled:a.processing,children:"Envoyer"})})]})]})]})]})]})}export{de as default};
